{%extends "base.html"%}

{%block head%}
<script src='//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js'></script>
<script type='text/javascript' src='/static/sidebar.js'></script>
<script type='text/javascript' src='/static/tables.js'></script>
{%endblock%}
{%block title%}New Students{%endblock%}
{%block content%}
<h1 >Student registration form for {{schooln}}</h1>
<p> {{ error }} </p>
<form name='registration' action='.' method='post' onsubmit='return validateForm()'> <!-- onsubmit='return validate();'> -->
    {% csrf_token %}
    <!-- {{ form.as_p  }} -->
    {% if user.is_authenticated %}
    {% else %}
        <p>Not working.</p>
    {% endif %}

    <!-- For "Confirm your school's language? -->
    <p> Please confirm your school's preferred language. </p>
    <select name = "language">
        <option value="e">English</option>
        <option value="a">Afrikaans</option>
		<option value="b">Bilingual</option>
    </select>

    <!-- register responsible teacher from here --->
    <div>
        <h1>Register Responsible Teacher</h1>
        <p>The responsible teacher may be contacted by the university on administrative matters. Compulsory 1 per school.<br><i> All fields marked with an <b>asterisk (*) must be filled.</b></i></p>
        <p> {{ ierror }} </p>
        {% csrf_token %}

        <table>
            <tr>
                <th>First Name*</th>
                <th>Surname</th>
                <th>Phone*</th>
                <th>Phone (Alternative)</th>
                <th>Email* </th>
            </tr>
            <tr>	<!-- the required attribute does not work with IE9 and lower -->
                <td><input type="text" name="rt_firstname" required value={{responsible_teacher.firstname|lower|capfirst}}></td>
                <td><input type="text" name="rt_surname" value={{responsible_teacher.surname|lower|capfirst}}></td>
                <td><input type ="text" name="rt_phone_primary" required value={{responsible_teacher.phone_primary}}></td>                    
                <td><input type ="text" name="rt_phone_alt" value={{responsible_teacher.phone_alt}}></td>
                <td><input id="rmail" type ="text" name="rt_email" required value={{responsible_teacher.email|lower}}></td>
                <input type ="hidden" name="rt_registered_by" value ={{ user.id }} >
            </tr>
        </table>
    </div>



    <!-- register invigilators from here -->
    <div>
        <h1>Register Invigilators</h1>
        <p>Please note that every school must send at least 1 Invigilator and that if the responsible teacher is going to invigilate kindly add your name to the Invigilators list. <br> Compulsory 1 per school, 2 if 75 entries.<br><i> All fields marked with an <b>asterisk (*) must be filled.</b></i></p>
        <p> {{ ierror }} </p>
        {% csrf_token %}

        <table>
            <tr>
                <!-- <th>School</th> -->
                <th>First Name*</th>
                <th>Surname</th>
                <!-- <th>Venue</th> -->
				<th>Phone* </th>
				<th>Phone (Alternative)</th>
				<th>Email* </th>
            </tr>
            <!-- Populates the list with previously registered invigilators -->

            <!-- then the first invigilator is always required -->
            {%for invigilator in invigilator_list%}
                {% if forloop.first %} <!-- if this is the first iteration of the loop -->
                <tr>
                    <td><input type="text" name="inv_firstname" required value={{invigilator.firstname|lower|capfirst}}></td>
                    <td><input type="text" name="inv_surname" required value={{invigilator.surname|lower|capfirst}}></td>
                    <td><input type ="text" name="inv_phone_primary" required value={{invigilator.phone_primary}}></td>                    
                    <td><input type ="text" name="inv_phone_alt" value={{invigilator.phone_alt}}></td>
                    <td><input type ="text" name="inv_email" required value={{invigilator.email|lower}}></td>
                    <input type ="hidden" name="inv_registered_by" value ={{ user.id }} >
                </tr>
                {% else %}
                <tr>
                    <td><input type="text" name="inv_firstname" value={{invigilator.firstname|lower|capfirst}}></td>
                    <td><input type="text" name="inv_surname" value={{invigilator.surname|lower|capfirst}}></td>
                    <td><input type ="text" name="inv_phone_primary" value={{invigilator.phone_primary}}></td>                    
                    <td><input type ="text" name="inv_phone_alt" value={{invigilator.phone_alt}}></td>
                    <td><input type ="text" name="inv_email" value={{invigilator.email|lower}}></td>
                    <input type ="hidden" name="inv_registered_by" value ={{ user.id }} >
                </tr>
                {% endif %}

            {%endfor%}
            
            {%for invigilator in invigilator_range%}
            {% if invigilator_list|length = 0 and loopcounter.first %}
                <tr>
                    <td><input type="text" required name="inv_firstname"></td>
                    <td><input type="text" required name="inv_surname"></td>
                    <td><input type ="text" required name="inv_phone_primary"></td>                    
                    <td><input type ="text" name="inv_phone_alt"></td>
                    <td><input type ="text" required name="inv_email"></td>
                    <input type ="hidden" name="inv_registered_by" value ={{ user.id }} >
                </tr>
            {% else %}
                <tr>
                    <td><input type="text" name="inv_firstname"></td>
                    <td><input type="text" name="inv_surname"></td>
                    <td><input type ="text" name="inv_phone_primary"></td>                    
                    <td><input type ="text" name="inv_phone_alt"></td>
                    <td><input type ="text" name="inv_email"></td>
                    <input type ="hidden" name="inv_registered_by" value ={{ user.id }} >
                </tr>
            {% endif %}

            {%endfor%}

        </table>


    </div>

    {%for grade in grades%}
    <div>
        <!-- <form action="." method="post"> -->
        <h2>Grade {{grade}}</h2>
        <div>
            <h3>Pairs:
            <select name = "pairs">
                  {%for key, pair_list in pairs_per_grade.items%}
                    {% if grade == key %}
                        {%for p in pair_list%}
                        <option value='{{p}}'>{{p}}</option>
                        {%endfor%}
                    {%endif%}
                 {%endfor%}
            </select>
            </h3>
        </div> 

        <h3>Individuals:</h3>
        <table>
        <tr>
            <th>Name*</th>
            <th>Surname</th>
        </tr>
        <!-- Populates the list with previously registered students -->
        {%for key, student_l in student_list.items%}
            {% if grade == key %} <!-- only for the current grade -->
                {%for student in student_l%}
                <tr>
                    <td><input type="text" name="firstname" value={{student.firstname|lower|capfirst}}></td>
                    <td><input type="text" name="surname" value={{student.surname|lower|capfirst}}></td>
                    <input type='hidden' name='grade' value='{{grade}}'>
                    <input type ="hidden" name="registered_by" value ={{ user.id }} >
                </tr>
                {%endfor%}
            {%endif%}
        {%endfor%}

        {%for key, entry_range in entries_per_grade.items%}
            {% if grade == key %}
                {% for entry in entry_range %}
                <tr>
                  <td><input type="text" name="firstname"></td>
                  <td><input type="text" name="surname"></td>
                  <input type='hidden' name='grade' value='{{grade}}'>
                  <input type ="hidden" name="registered_by" value ={{ user.id }} >
                </tr>
                {%endfor%}
            {%endif%}
        {%endfor%}

        </table>
        <br><br>
    </div>
    {%endfor%} <!-- endfor grade -->
	<div id='alert'>
		<input type="checkbox" name="confirm" align="left" onclick="disableElement(this)"> Have you confirmed that all the information entered is correct? <br> </br>
    </div>
    <input class="bluebutton left" id='complete' type="submit" name='submit_form' value="Submit" disabled>

    </form>
{%endblock%}
