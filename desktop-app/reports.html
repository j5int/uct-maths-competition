<HTML>     
<HEAD>         
<TITLE>UCT Mathematics Competition Database</TITLE>   

<SCRIPT type="text/VBScript">
Dim oConn 
Dim strPath
Dim recordSet

strPath = Replace( document.location, "reports.html", "", 9, 1, 1 )
strPath = Replace( strPath, "%20", " " )
If InStr( strPath, "?" ) > 1 Then
	strPath = Mid( strPath, 1, InStr( strPath, "?" ) - 1 )
End If

Set oConn = CreateObject("ADODB.Connection")
oConn.Open "DBQ="& strPath &"db1.mdb;Driver={Microsoft Access Driver (*.mdb)};DriverId=25;FIL=MS Access;"  

Function getName
	Dim name1
	Dim name2
	Dim strRet

	strRet = ""

	name1 = recordSet( 0 )
	If name1 = "" Then
		name1 = recordSet(1)
	Else
		name1 = name1 & " " & recordSet(1)
	End If

	If ( 0 + Right( recordSet(2), 2 ) ) > 5 Then
		name2 = ""
		recordSet.MoveNext
		name2 = recordSet( 0 )
		If name2 = "" Then
			name2 = recordSet(1)
		Else
			name2 = name2 & " " & recordSet(1)
		End If

		If name1 = "" And name2 = "" Then
			strRet = "Pair / Paar "
			Select Case ( Right( recordSet(2), 2 ) )
				Case "06"
					strRet = strRet & "A"
				Case "07"
					strRet = strRet & "B"
				Case "08"
					strRet = strRet & "C"
				Case "09"
					strRet = strRet & "D"
				Case "10"
					strRet = strRet & "E"
			End Select
		Else
			If name1 = "" Then
				name2 = name1
				name1 = ""
			End If

			If name1 = "" Or name2 = "" Then
				' Only one partner named and it is in name1
				strRet = name1 & " and partner"
			Else
				strRet = name1 & " / " & name2
			End If
		End If
	Else
		' Working with individuals
		If name1 = "" Then
			strRet = "Individual " & Right( recordSet(2), 1 ) 
		Else
			strRet = name1
		End If
	End If
	
	getName = strRet
End Function

</SCRIPT>  

</HEAD>      

<BODY BGCOLOR="White" topmargin="10" leftmargin="10"><font face="Verdana, Arial, Helvetica">

<p id="showData"></p>
<SCRIPT type="text/VBScript">
	document.all.item( "showData" ).style.display = "none"
</SCRIPT>

<table id="showTable">
<tr><td>

<!-- Heading 			-->
<table width="100%">
	<tr>
		<td align="center" width=26%>
			<IMAGE src="uct.gif" alt="UCT Logo">
		</td>
		<td align="center">
			<font size="6" face="Arial, Helvetica"><b>UCT Mathematics Competition</b></font><br>      
		</td>
		<td align="center" width=26%>
			<IMAGE src="maths.gif" alt="Mathematics Competition Logo">
		</td>
	</tr>
	<tr>
		<td colspan=3>
			<hr size="1" color="#000000">
		</td>
	</tr>
	<tr>
		<td align="center" colspan="3">
			<big><b>Reports</big></b>
		</td>
	</tr>
	<tr>
		<td colspan=3 align=right>
			<a href="maths_competition.html">Back to main menu</a>
		</td>
	</tr>
</table>
<!-- End Heading 		-->

<table width=100%>
	<tr>
		<td>
			<BR>
		</td>
	</tr>
	<tr>
		<td valign="top">
			<big><b>Instructions:</b></big>&nbsp;
		</td>
		<td valign="top">
			Select a report type.  The screen will change to show a printable version of the report.
			Select "File" on the Browser Menu and Select "Print..." to print the report. <BR>
			<BR><i>Note:</i> The printing format should be portrait, A4, all margins set to the smallest possible
			and one page per printed page (no 2-up, etc) to obtain the intended results of the report.<BR>
			<BR>When you are finished with the report, press "Refresh" (F5) to get back to this screen.
		</td>
	</tr>
	<tr>
		<td>
			<BR>
		</td>
	</tr>
</table>

<table width=100%>
	<tr>
		<td  align=left>
			<HR size=1 width=80%>
		</td>
	</tr>
	<tr>
		<td>
			<b>School/Key Pairs</b>
			<small> - Shows an alphabetical list of schools with their respective keys.</small>
		</td>
	</tr>
	<tr>
		<FORM method="get" action="reports.html" name="schoolKeys">
		<td align="center">
			<SELECT name="startSchoolKey">
<SCRIPT type="text/VBScript">

Set recordSet = oConn.Execute( "SELECT DISTINCT Name FROM Schools ORDER BY Name" )

Do While Not recordSet.eof
	document.write "<OPTION>" & recordSet(0) & "</OPTION>"
	recordSet.MoveNext
Loop

</SCRIPT>
			</SELECT>
			to
			<SELECT name="endSchoolKey">
<SCRIPT type="text/VBScript">
Dim iTotal
iTotal = 0
Set recordSet = oConn.Execute( "SELECT DISTINCT Name FROM Schools ORDER BY Name" )

Do While Not recordSet.eof
	document.write "<OPTION>" & recordSet(0) & "</OPTION>"
	recordSet.MoveNext
	iTotal = iTotal + 1
Loop
document.all.item( "endSchoolKey" ).selectedindex = iTotal - 1

</SCRIPT>
			</SELECT>
			<INPUT type=button name=showKeys value="Show Report">
<SCRIPT type="text/VBScript">
Sub showKeys_OnClick
	Dim strHTML
	Dim strStart
	Dim strEnd
	Dim index

	strStart = ""
	strEnd   = ""

	Set recordSet = oConn.Execute( "SELECT Name FROM Schools ORDER BY Name" )
	For index = 0 to document.schoolKeys.endSchoolKey.selectedIndex - 1
		If Not recordSet.eof Then
			If index = document.schoolKeys.startSchoolKey.selectedIndex Then
				strStart = recordSet(0)
			End If
			recordSet.MoveNext
		End If
	Next
	
	If Not recordSet.eof Then
		strEnd = recordSet(0)
	End If

	strHTML   = "<table style=""font-family: verdana; font-size: 10pt"">"
	Set recordSet = oConn.Execute( "SELECT Name, Key FROM Schools WHERE Name >= '" & strStart & "' AND Name <= '" & strEnd & "' ORDER BY Name" )
	If recordSet.eof Then
		strHTML = strHTML & "<tr><td align=center>There are no schools entered yet.</td></tr>"
	End If

	index = 0
	Do While Not recordSet.eof
		If index Mod 41 = 0 Then
			strHTML = strHTML & "<tr><td><b>School</b></td><td></td><td><b>Key</b></tr><tr><td colspan=3><hr size=2></td></tr>"
		End If

		strHTML = strHTML & "<tr><td>" & recordSet(0) & "</td><td>&nbsp;&nbsp;&nbsp;&nbsp;</td><td>" & recordSet(1) & "</td></tr>"
		recordSet.MoveNext
		index = index + 1
	Loop

	strHTML = strHTML & "</table>"

	document.all.item( "showTable" ).style.display = "none"
	document.all.item( "showData" ).style.display  = ""
	document.all.item( "showData" ).innerHTML = strHTML
End Sub
</SCRIPT>
		</td>
		</FORM>
	</tr>
	<tr>
		<td align=left>
			<HR size=1 width=80%>
		</td>
	</tr>
	<tr>
		<td>
			<b>Student Register - (AND Assigns Students to Venues)</b>
			<small> - A report of each student and the venue that they have been assigned to. If this DOES NOT run - there may be a Temp table that has not been deleted</small>
		</td>
	</tr>
	<tr>
		<FORM name="registerForm">
		<td>
			Select grade:
			<SELECT name="register_grade">
				<OPTION>All</OPTION>
				<OPTION>8</OPTION>
				<OPTION>9</OPTION>
				<OPTION>10</OPTION>
				<OPTION>11</OPTION>
				<OPTION>12</OPTION>
			</SELECT>
			&nbsp;Type:
			<SELECT name="register_type">
				<OPTION>All</OPTION>
				<OPTION>Individuals</OPTION>
				<OPTION>Pairs</OPTION>
			</SELECT>
			<INPUT type=button name=showRegister value="Show Register">
<SCRIPT type="text/VBScript">

' iType = 0 -> Both
' iType = 1 -> Individuals only
' iType = 2 -> Pairs only
Sub assignVenues( iStart, iEnd, iType )
	Dim recordSet2
	Dim students
	Dim studentBums
	Dim iGrades
	Dim iPairs
	Dim iIndividuals
	Dim strSchool

	Dim strVenue
	Dim iBumsLeft

'	Set recordSet = oConn.Execute( "DROP TABLE temp" )
	Set recordSet = oConn.Execute( "CREATE TABLE temp( School text, PairCount int, IndCount int )" )

	For iGrades = iStart to iEnd
		' First get the pair and individual counts
		Set recordSet = oConn.Execute( "SELECT * FROM Students WHERE Grade=" & iGrades & " AND Venue='' ORDER BY School, Reference" )
		Do While Not recordSet.eof
			strSchool    = recordSet(3)
			iPairs       = 0
			iIndividuals = 0

			Do While Not recordSet.eof
				If StrComp( strSchool, recordSet(3) ) <> 0 Then
					Exit Do
				End If

				If 0 + Right( recordSet(2), 2) < 6 Then
					iIndividuals = iIndividuals + 1
				Else
					iPairs = iPairs + 1
				End If

				recordSet.MoveNext
			Loop
		
			recordSet2 = oConn.Execute( "INSERT INTO temp VALUES ( '" & strSchool & "'," & iPairs & "," & iIndividuals & ")" )
		Loop

		If iType <> 2 Then
			' Get the individual venues 
			Set recordSet2 = oConn.Execute( "SELECT * FROM Venues WHERE Grade=" & iGrades & " AND Pairs=0 ORDER BY Bums DESC" )

			iBumsLeft = 0
			Do While Not recordSet2.eof And iBumsLeft <= 0 
				' Set up the first venue's info
				strVenue = recordSet2(1) & " " & recordSet2(0)
				iBumsLeft = recordSet2(3)
				Set studentBums = oConn.Execute( "SELECT Reference FROM Students WHERE Venue='" & strVenue & "'" )
				Do While Not studentBums.eof
					iBumsLeft = iBumsLeft - 1
					studentBums.MoveNext
				Loop

				recordSet2.MoveNext
			Loop

			If recordSet2.eof And iBumsLeft = 0 Then
				MsgBox "Insuffient space to handle Grade " & iGrades & ", Individuals.1"
			Else
				' Get the school individual counts
				Set recordSet  = oConn.Execute( "SELECT * FROM temp WHERE IndCount > 0 ORDER BY IndCount, School" )
				' Time to assign the individual venues
				Do While Not recordSet.eof
					Do While Not recordSet.eof 
						If recordSet(2) < iBumsLeft Then
							Exit Do
						End If

						recordSet.MoveNext
					Loop

					If Not recordSet.eof Then
						strSchool = recordSet(0)

						' Assign the venue...
						Set students = oConn.Execute( "SELECT * FROM Students WHERE School='" & strSchool & "' AND Grade=" & iGrades & " ORDER BY Reference" )
						Do While Not students.eof
							If 0 + Right( students(2), 2 ) < 6 Then
								oConn.Execute( "UPDATE Students SET Venue='" & strVenue & "' WHERE Reference='" & students(2) & "'" )
								iBumsLeft = iBumsLeft - 1
							Else
								students.MoveNext
							End If

							If Not recordSet.eof Then
								students.MoveNext
							End If
						Loop
						oConn.Execute( "UPDATE temp SET IndCount=0 WHERE School='" & strSchool & "'" )
		
						recordSet.MoveNext
						If recordSet.eof Then
							Set recordSet  = oConn.Execute( "SELECT * FROM temp WHERE IndCount > 0 ORDER BY IndCount, School" )
						End If

						If iBumsLeft <= 0 Then
							' We need another venue
							iBumsLeft = 0
							Do While Not recordSet2.eof And iBumsLeft <= 0 
								' Set up the venue's info
								strVenue = recordSet2(1) & " " & recordSet2(0)
								iBumsLeft = recordSet2(3)
								Set studentBums = oConn.Execute( "SELECT Reference FROM Students WHERE Venue='" & strVenue & "'" )
								Do While Not studentBums.eof
									iBumsLeft = iBumsLeft - 1
								Loop
			
								recordSet2.MoveNext
							Loop
					
							Set recordSet  = oConn.Execute( "SELECT * FROM temp WHERE IndCount > 0 ORDER BY IndCount, School" )
							If Not recordSet.eof And recordSet2.eof And iBumsLeft = 0 Then
								MsgBox "Insuffient space to handle Grade " & iGrades & ", Individuals.2"
								Exit Do
							End If

						End If
					Else
						' We've been through the whole list, move onto another venue...
						iBumsLeft = 0
						Do While Not recordSet2.eof And iBumsLeft <= 0 
							' Set up the venue's info
							strVenue = recordSet2(1) & " " & recordSet2(0)
							iBumsLeft = recordSet2(3)
							Set studentBums = oConn.Execute( "SELECT Reference FROM Students WHERE Venue='" & strVenue & "'" )
							Do While Not studentBums.eof
								iBumsLeft = iBumsLeft - 1
								studentBums.MoveNext
							Loop
			
							recordSet2.MoveNext
						Loop
						Set recordSet = oConn.Execute( "SELECT * FROM temp WHERE IndCount > 0 ORDER BY IndCount, School" )
						If Not recordSet.eof And recordSet2.eof And iBumsLeft = 0 Then
							MsgBox "Insuffient space to handle Grade " & iGrades & ", Individuals.3"
							Exit Do
						End If
					End If
				Loop
			End If
		End If

		If iType <> 1 Then
			' Get the Pair venues 
			Set recordSet2 = oConn.Execute( "SELECT * FROM Venues WHERE Grade=" & iGrades & " AND Pairs<>0 ORDER BY Bums DESC" )

			iBumsLeft = 0
			Do While Not recordSet2.eof And iBumsLeft <= 0 
				' Set up the first venue's info
				strVenue = recordSet2(1) & " " & recordSet2(0)
				iBumsLeft = recordSet2(3)
				Set studentBums = oConn.Execute( "SELECT Reference FROM Students WHERE Venue='" & strVenue & "'" )
				Do While Not studentBums.eof
					iBumsLeft = iBumsLeft - 1
					studentBums.MoveNext
				Loop

				recordSet2.MoveNext
			Loop

			If recordSet2.eof And iBumsLeft = 0 Then
				MsgBox "Insuffient space to handle Grade " & iGrades & ", Pairs."
			Else
				' Get the school pair counts
				Set recordSet  = oConn.Execute( "SELECT * FROM temp WHERE PairCount > 0 ORDER BY PairCount, School" )

				' Time to assign the pair venues
				Do While Not recordSet.eof
					Do While Not recordSet.eof 
						If recordSet(2) < iBumsLeft Then
							Exit Do
						End If

						recordSet.MoveNext
					Loop

					If Not recordSet.eof Then
						strSchool = recordSet(0)

						' Assign the venue...
						Set students = oConn.Execute( "SELECT * FROM Students WHERE School='" & strSchool & "' AND Grade=" & iGrades & " ORDER BY Reference" )
						Do While Not students.eof
							If 0 + Right( students(2), 2 ) > 5 Then
								oConn.Execute( "UPDATE Students SET Venue='" & strVenue & "' WHERE Reference='" & students(2) & "'" )
								iBumsLeft = iBumsLeft - 1
							End If

							students.MoveNext
						Loop
						oConn.Execute( "UPDATE temp SET PairCount=0 WHERE School='" & strSchool & "'" )
		
						recordSet.MoveNext
						If recordSet.eof Then
							Set recordSet  = oConn.Execute( "SELECT * FROM temp WHERE PairCount > 0 ORDER BY PairCount, School" )
						End If

						If iBumsLeft <= 0 Then
							' We need another venue
							iBumsLeft = 0
							Do While Not recordSet2.eof And iBumsLeft <= 0 
								' Set up the venue's info
								strVenue = recordSet2(1) & " " & recordSet2(0)
								iBumsLeft = recordSet2(3)
								Set studentBums = oConn.Execute( "SELECT Reference FROM Students WHERE Venue='" & strVenue & "'" )
								Do While Not studentBums.eof
									iBumsLeft = iBumsLeft = 1
								Loop
			
								recordSet2.MoveNext
							Loop
					
							Set recordSet = oConn.Execute( "SELECT * FROM temp WHERE PairCount > 0 ORDER BY PairCount, School" )
							If recordSet2.eof And Not recordSet.eof And iBumsLeft = 0 Then
								MsgBox "Insuffient space to handle Grade " & iGrades & ", Pairs."
								Exit Do
							End If
						End If
					Else
						' We've been through the whole list, move onto another venue...
						iBumsLeft = 0
						Do While Not recordSet2.eof And iBumsLeft <= 0 
							' Set up the venue's info
							strVenue = recordSet2(1) & " " & recordSet2(0)
							iBumsLeft = recordSet2(3)
							Set studentBums = oConn.Execute( "SELECT Reference FROM Students WHERE Venue='" & strVenue & "'" )
							Do While Not studentBums.eof
								iBumsLeft = iBumsLeft = 1
							Loop
			
							recordSet2.MoveNext
						Loop
					
						Set recordSet = oConn.Execute( "SELECT * FROM temp WHERE PairCount > 0 ORDER BY IndCount, School" )
						If Not recordSet.eof And recordSet2.eof And iBumsLeft = 0 Then
							MsgBox "Insuffient space to handle Grade " & iGrades & ", Pairs."
							Exit Do
						End If
					End If
				Loop
			End If
		End If

		Set recordSet2 = oConn.Execute( "DELETE FROM temp" )
	Next

	recordSet.Close
'	recordSet2.Close
	Set recordSet2 = oConn.Execute( "DROP TABLE temp" )
End Sub

' iType = 0 -> Both
' iType = 1 -> Individuals only
' iType = 2 -> Pairs only
Sub showRegister( iStart, iEnd, iType )
	Dim strHTML
	Dim iGrade

	strHTML = "<table width=100% style=""font-family: verdana; font-size: 10pt""><tr><td colspan=4><b><big>Student Register</big></b></td></tr>"
	strHTML = strHTML & "<tr><td><i>School</i></td><td><i>Code</i></td><td><i>Name</i></td><td><i>Venue</i></td></tr>"

	For iGrade = iStart to iEnd
		If iType <> 2 Then
			strHTML = strHTML & "<tr><td><big><b>Grade " & iGrade & " Individuals<b><big></td></tr>"

			Set recordSet = oConn.Execute( "SELECT * FROM Students WHERE Grade=" & iGrade & " ORDER BY School, Reference" )

			Do while Not recordSet.eof
				If 0 + Right( recordSet(2), 2 ) < 6 Then
					'Individual
					strHTML = strHTML & "<tr><td>" & recordSet(3) & "</td><td>" & recordSet(2) & "</td><td>" & getName() & "</td><td>" & recordSet(9) & "</td></tr>"
				Else
					recordSet.MoveNext
				End If

				recordSet.MoveNext
			Loop
		End If

		If iType <> 1 Then
			strHTML = strHTML & "<tr><td><big><b>Grade " & iGrade & " Pairs<b><big></td></tr>"

			Set recordSet = oConn.Execute( "SELECT * FROM Students WHERE Grade=" & iGrade & " ORDER BY School, Reference" )

			Do while Not recordSet.eof
				If 0 + Right( recordSet(2), 2 ) > 5 Then
					'Pair
					strHTML = strHTML & "<tr><td>" & recordSet(3) & "</td><td>" & recordSet(2) & "</td><td>" & getName() & "</td><td>" & recordSet(9) & "</td></tr>"
				End If

				recordSet.MoveNext
			Loop
		End If
	Next

	document.all.item( "showTable" ).style.display = "none"
	document.all.item( "showData" ).style.display  = ""
	document.all.item( "showData" ).innerHTML      = strHTML
End Sub

Sub showRegister_OnClick
	Dim bRerun
	Dim iMsgRet
	Dim iStart
	Dim iEnd

	If document.registerForm.register_grade.selectedIndex = 0 Then
		iStart = 8
		iEnd   = 12
	Else
		iStart = document.registerForm.register_grade.selectedIndex + 7
		iEnd   = document.registerForm.register_grade.selectedIndex + 7
	End If

	iRerun = 0

	Set recordSet = oConn.Execute( "SELECT DISTINCT Venue FROM Students WHERE Venue=''" )
	If Not recordSet.eof Then
		' We have some empty entries

		Set recordSet = oConn.Execute( "SELECT DISTINCT Venue FROM Students Where Venue<>''" )
		If Not recordSet.eof Then
			iMsgRet = MsgBox( "Would you like to only assign those entries that haven't been assigned yet? Note: This may mean that members of the same school could be split.", vbYesNo )
			If iMsgRet = vbNo Then
				Set recordSet = oConn.Execute( "UPDATE Students SET Venue='' WHERE Grade>=" & iStart & " AND Grade<=" & iEnd )
			End If
		End If
		assignVenues iStart, iEnd, document.registerForm.register_type.selectedIndex 
	End If

	'Show the register now
	showRegister iStart, iEnd, document.registerForm.register_type.selectedIndex
End Sub
</SCRIPT>
		</td>
		</FORM>
	</tr>
	<tr>
		<td align=left>
			<HR size=1 width=80%>
		</td>
	</tr>
	<tr>
		<td>
			<b>Prize Winner Report</b>
			<small> - All the prize winners with their respective ranks.</small>
		</td>
	</tr>
	<tr>
		<FORM name="prizeWinnersForm">
		<td>
			Select grade:
			<SELECT name="prize_grade">
				<OPTION>All</OPTION>
				<OPTION>8</OPTION>
				<OPTION>9</OPTION>
				<OPTION>10</OPTION>
				<OPTION>11</OPTION>
				<OPTION>12</OPTION>
			</SELECT>
			<INPUT type=button name=showPrizeWinners value="Show Report">
<SCRIPT type="text/VBScript">
Sub showPrizeWinners_OnClick
	Dim strHTML
	Dim iStart
	Dim iEnd
	Dim iGrade
	Dim iEntry

	strHTML = "<table width=60% style=""font-family: verdana; font-size: 10pt""><tr><td colspan=2><big><b>Prize Winner List</b></big></td></tr>"

	If document.prizeWinnersForm.prize_grade.selectedIndex = 0 Then
		iStart = 8
		iEnd   = 12
	Else
		iStart = document.prizeWinnersForm.prize_grade.selectedIndex + 7
		iEnd   = document.prizeWinnersForm.prize_grade.selectedIndex + 7
	End If

	For iGrade = iStart to iEnd
		strHTML = strHTML & "<tr><td><BR></td></tr>"

		strHTML = strHTML & "<tr><td colspan=2><b>Grade " & iGrade & ", Individual Prize Winners</b></td></tr>"
		strHTML = strHTML & "<tr><td><b>Gold Prizes:</b></td></tr>"
		strHTML = strHTML & "<tr><td><i>Student</i></td><td><i>School</i></td><td align=center><i>Rank</i></td></tr>"
		
		Set recordSet = oConn.Execute( "SELECT * FROM Students WHERE Rank > 0 AND Rank <= 10 AND Grade=" & iGrade & " ORDER BY Rank, Reference" )
		Do While Not recordSet.eof
			If ( 0 + Right( recordSet(2), 2 ) ) < 6 Then
				strHTML = strHTML & "<tr><td>" & getName() & "</td><td>" & recordSet(3) & "</td><td align=center>" & recordSet(5) & "</td></tr>"
			Else
				' Jump over the pairs
				recordSet.MoveNext
			End If
			' Move to next entry
			recordSet.MoveNext
		Loop

		strHTML = strHTML & "<tr><td><BR></td></tr><tr><td><b>Merit Prizes:</b></td></tr>"
		Set recordSet = oConn.Execute( "SELECT * FROM Students WHERE Rank > 10 AND Rank <= 200 AND Grade=" & iGrade & " ORDER BY Rank, Reference" )
		Do While Not recordSet.eof
			If ( 0 + Right( recordSet(2), 2 ) ) < 6 Then
				strHTML = strHTML & "<tr><td>" & getName() & "</td><td>" & recordSet(3) & "</td><td align=center>" & recordSet(5) & "</td></tr>"
			Else
				' Jump over the pairs
				recordSet.MoveNext
			End If
			' Move to next entry
			recordSet.MoveNext
		Loop


		strHTML = strHTML & "<tr><td><BR></td></tr>"

		strHTML = strHTML & "<tr><td colspan=2><b>Grade " & iGrade & ", Pair Prize Winners</b></td></tr>"
		strHTML = strHTML & "<tr><td><b>Gold Prizes:</b></td></tr>"
		strHTML = strHTML & "<tr><td><i>Student</i></td><td><i>School</i></td><td><i>Rank</i></td></tr>"
		
		Set recordSet = oConn.Execute( "SELECT * FROM Students WHERE Rank > 0 AND Rank <= 3 AND Grade=" & iGrade & " ORDER BY Rank, Reference" )
		Do While Not recordSet.eof
			If ( 0 + Right( recordSet(2), 2 ) ) > 5 Then
				strHTML = strHTML & "<tr><td>" & getName() & "</td><td>" & recordSet(3) & "</td><td align=center>" & recordSet(5) & "</td></tr>"
			End If
			' Move to next entry
			recordSet.MoveNext
		Loop

		strHTML = strHTML & "<tr><td><BR></td></tr><tr><td><b>Merit Prizes:</b></td></tr>"
		Set recordSet = oConn.Execute( "SELECT * FROM Students WHERE Rank > 3 AND Rank <= 100 AND Grade=" & iGrade & " ORDER BY Rank, Reference" )
		Do While Not recordSet.eof
			If ( 0 + Right( recordSet(2), 2 ) ) > 5 Then
				strHTML = strHTML & "<tr><td>" & getName() & "</td><td>" & recordSet(3) & "</td><td align=center>" & recordSet(5) & "</td></tr>"
			End If
			' Move to next entry
			recordSet.MoveNext
		Loop
	Next

	strHTML = strHTML & "</table>"

	document.all.item( "showTable" ).style.display = "none"
	document.all.item( "showData" ).style.display  = ""
	document.all.item( "showData" ).innerHTML = strHTML
End Sub
</SCRIPT>
		</td>
		</FORM>
	</tr>
	<tr>
		<td align=left>
			<HR size=1 width=80%>
		</td>
	</tr>
	<tr>
		<FORM name=schoolPrizeForm>
		<td>
			<b>School Prize Winners</b>
			<small> - Each student that qualifies for the School Prize.</small>
			<INPUT type=button name=showSchoolPrize value="Show Report">
<SCRIPT type="text/VBScript">
Sub showSchoolPrize_OnClick
	Dim strHTML
	Dim strSchool
	Dim strLine
	Dim recordSet2
	Dim bGold

	strHTML = "<table width=70% style=""font-family: verdana; font-size: 10pt""><tr><td><big><b>School Prize Winners</b></big></td></tr><tr><td><i>School</i></td><td><i>Grade</i></td><td><i>Student</i></td><td><i>Rank</i></td></tr>"

	Set recordSet2 = oConn.Execute( "SELECT DISTINCT Name FROM Schools WHERE Entered<>0 ORDER BY Name" )
	Do While Not recordSet2.eof
		strLine   = ""
		strSchool = recordSet2(0)

		Set recordSet = oConn.Execute( "SELECT Rank, Reference FROM Students WHERE School='" & strSchool & "' AND Rank<=10 AND Rank>0" )

		bGold = false
		If Not recordSet.eof Then
			Do While Not recordSet.eof
				If recordSet(0) < 3 Then
					bGold = true
					Exit Do
				End If

				If ( 0 + Right( recordSet(1), 2 ) ) < 6 Then
					bGold = true
					Exit Do
				End If

				recordSet.MoveNext
			Loop
		End If

		If Not bGold Then
			' Okay, no gold prizes.  Check the number of individual entries > 10.
			Dim iEntries

			iEntries = 0
			Set recordSet = oConn.Execute( "SELECT * FROM Students WHERE School='" & strSchool & "' AND Rank>0 ORDER BY Rank" )
			Do While iEntries < 10 And Not recordSet.eof
				If ( 0 + Right( recordSet(2), 2 ) ) < 6 Then
					If iEntries = 0 Then
						strLine = "<tr><td>" & strSchool & "</td><td>" & recordSet(6) & "</td><td>" & getName() & "</td><td>" & recordSet(5) & "</td></tr>"
					End If
					iEntries = iEntries + 1
				End If
				recordSet.MoveNext
			Loop

			If iEntries >= 10 Then
				' We have a winner
				strHTML = strHTML & strLine
			End If
		End If

		recordSet2.MoveNext
	Loop

	strHTML = strHTML & "</table>"

	document.all.item( "showTable" ).style.display = "none"
	document.all.item( "showData" ).style.display  = ""
	document.all.item( "showData" ).innerHTML = strHTML
End Sub
</SCRIPT>
		</td>
		</FORM>
	</tr>
	<tr>
		<td align=left>
			<HR size=1 width=80%>
		</td>
	</tr>
	<tr>
		<td>
			<b>School Ranking</b>
			<small> - The ranking of all the schools.</small>
		</td>
	</tr>
	<tr>
		<FORM name=showSchoolRanksForm>
		<td>
			Show Top <INPUT type=text name=topSchools value=30 size=2> Schools
			<INPUT type=button name=showSchoolRanks value="Show Report">
<SCRIPT type="text/VBScript">
Sub showSchoolRanks_OnClick
	Dim strHTML
	Dim iPosition
	Dim iRank
	Dim iScore
	If Not IsNumeric( document.showSchoolRanksForm.topSchools.value ) Or document.showSchoolRanksForm.topSchools.value = "" Then
		MsgBox "The number of Schools to list must be numeric."
	Else
		strHTML = "<table width=40% style=""font-family: verdana; font-size: 10pt""><tr><td colspan=3><b><big>School Ranking</b></big><tr><td><BR></td></tr>"
		strHTML = strHTML & "<tr><td><i>Rank</i></td><td><i>School</i></td><td><i>Score</i></td></tr>"

		Set recordSet = oConn.Execute( "SELECT * FROM Schools WHERE Entered<>0 ORDER BY Score DESC" )
	
		iRank = 0
		iPosition = 0
		iScore = 999999	'Something higher than will ever be seen
		Do While Not recordSet.eof And iRank < 0 + document.showSchoolRanksForm.topSchools.value
			iPosition = iPosition + 1
			If iScore > recordSet(8) Then
				iScore = recordSet(8)
				iRank = iPosition
			End If

			strHTML = strHTML & "<tr><td>" & iRank & "</td><td>" & recordSet(0) & "</td><td>" & recordSet(8) & "</td></tr>"

			recordSet.MoveNext
		Loop

		strHTML = strHTML & "</table>"

		document.all.item( "showTable" ).style.display = "none"
		document.all.item( "showData" ).style.display  = ""
		document.all.item( "showData" ).innerHTML = strHTML
	End If
End Sub
</SCRIPT>
		</td>
		</FORM>
	</tr>
	<tr>
		<td align=left>
			<HR size=1 width=80%>
		</td>
	</tr>
	<tr>
		<td>
			<b>School Results</b>
			<small> - A report for each school showing how their students did within the school.</small>
		</td>
	</tr>
	<tr>
		<FORM method="get" action="reports.html" name="schoolResults">
		<td align="center">
			<SELECT name="startSchoolResults">
<SCRIPT type="text/VBScript">

Set recordSet = oConn.Execute( "SELECT DISTINCT Name FROM Schools WHERE Entered<>0 ORDER BY Name" )

Do While Not recordSet.eof
	document.write "<OPTION>" & recordSet(0) & "</OPTION>"
	recordSet.MoveNext
Loop

</SCRIPT>
			</SELECT>
			to
			<SELECT name="endSchoolResults">
<SCRIPT type="text/VBScript">
Dim iTotal
iTotal = 0
Set recordSet = oConn.Execute( "SELECT DISTINCT Name FROM Schools WHERE Entered<>0 ORDER BY Name" )

Do While Not recordSet.eof
	document.write "<OPTION>" & recordSet(0) & "</OPTION>"
	recordSet.MoveNext
	iTotal = iTotal + 1
Loop
document.all.item( "endSchoolResults" ).selectedindex = iTotal - 1

</SCRIPT>
			</SELECT>
			<INPUT type=button name=showSchoolResults value="Show Report">
<SCRIPT type="text/VBScript">

Function showSchool( strSchool, strSchoolPrizeRef )
	Dim strRet
	Dim name1
	Dim name2
	Dim iCount

	strRet = ""

	iCount = 50
	For iGrade = 8 to 12 
		strRet = strRet & "<tr><td></td><td colspan=5>Grade / Graad " & iGrade & "</td></tr>"

		Set recordSet = oConn.Execute( "SELECT * FROM Students WHERE School='" & strSchool & "' AND Grade=" & iGrade & " ORDER BY Reference" )
		If recordSet.eof Then
			strRet = strRet & "<tr><td colspan=3 align=center><i>No Entries</i></td></tr>"
			iCount = iCount - 1
		Else
			Do While Not recordSet.eof
				strRet = strRet & "<tr><td></td>"
	
				' Reference
				strRet = strRet & "<td align=center>" & recordSet(2) & "</td>"
	
				' Names
				strRet = strRet & "<td>" & getName() & "</td>"

				' Score
				If recordSet(4) = -1 Then
					strRet = strRet & "<td align=center>Absent</td>"
				Else
					strRet = strRet & "</td><td align=center>" & recordSet(4) & "</td>"
				End If

				If recordSet(5) = -1 Then
					strRet = strRet & "<td></td>"
				Else
					If recordSet(2) = strSchoolPrizeRef Then
						strRet = strRet & "<td align=center>" & recordSet(5) & "</td><td>School"
						If recordSet(2) < 200 Then
							strRet = strRet & " & Merit"
						End If
						strRet = strRet & "</td>"
					Else
						If recordSet(5) > 200 Or recordSet(5) <= 0 Then
							strRet = strRet & "<td align=center></td><td></td>"
						Else
							If ( 0 + Right( recordSet(2), 2 ) ) < 6 Then
								' Individuals
								strRet = strRet & "<td align=center>" & recordSet(5) & "</td>"
								If recordSet(5) <= 10 Then
									strRet = strRet & "<td>Gold</td>"
								Else
									strRet = strRet & "<td>Merit</td>"
								End If
							Else
								' Pairs
								If recordSet(5) <= 100 Then
									strRet = strRet & "<td align=center>" & recordSet(5) & "</td>"
									If recordSet(5) <= 3 Then
										strRet = strRet & "<td>Gold</td>"
									Else
										strRet = strRet & "<td>Merit</td>"
									End If
								Else
									strRet = strRet & "<td align=center></td><td></td>"
								End If
							End If
						End If
					End If
				End If

				strRet = strRet & "</tr>"
	
				recordSet.MoveNext
				iCount = iCount - 1		
			Loop
		End If
	Next

	Do While iCount >= 0 
		strRet = strRet & "<tr><td><BR></td></tr>"
		iCount = iCount - 1
	Loop

	showSchool = strRet
End Function

Sub showSchoolResults_OnClick
	Dim strHTML
	Dim strHeadingStart
	Dim strHeadingEnd
	Dim strLabels
	Dim strStart
	Dim strEnd
	Dim index
	Dim recordSet2
	Dim strSchoolPrizeRef
	Dim schoolSet

	Dim bGold

	strStart = ""
	strEnd   = ""

	Set recordSet2 = oConn.Execute( "SELECT Name FROM Schools WHERE Entered<>0 ORDER BY Name" )
	For index = 0 to document.schoolResults.endSchoolResults.selectedIndex - 1
		If Not recordSet2.eof Then
			If index = document.schoolResults.startSchoolResults.selectedIndex Then
				strStart = recordSet2(0)
			End If
			recordSet2.MoveNext
		End If
	Next
	
	If Not recordSet2.eof Then
		strEnd = recordSet2(0)
		If index = document.schoolResults.startSchoolResults.selectedIndex Then
			strStart = recordSet2(0)
		End If
	End If

	strHTML = "<table>"

	Set recordSet2 = oConn.Execute( "SELECT Name FROM Schools WHERE Entered<>0 AND Name >= '" & strStart & "' AND Name <= '" & strEnd & "' ORDER BY Name" )
	If recordSet2.eof Then
		strHTML = strHTML & "<tr><td align=center>There are no schools to report on in the selection.</td></tr>"
	End If

	strHeadingStart = "<table width=100%><tr><td align=center width=33%><IMAGE src=""uct.gif"" alt=""UCT Logo""></td><td width=34% align=center><font size=4 face=""Arial, Helvetica""><b>UCT Mathematics Competition 2012</b></td><td align=center><IMAGE src=""maths.gif"" alt=""Mathematics Competition Logo""></td></tr><tr><td align=center colspan=3><b>"
	strHeadingEnd   = "</b></td></tr></table>"
	strLabels       = "<tr><td width=5%></td><td align=center>Code/Kode</td><td>Name/Naam</td><td align=center>Score/Punte</td><td align=center>Rank/Rang</td><td>Award/Toekenning</td></tr>"

	Do While Not recordSet2.eof
		' Find the School Prize winner and hang on to it...
		strSchoolPrizeRef = ""

		Set schoolSet = oConn.Execute( "SELECT Rank, Reference FROM Students WHERE School='" & recordSet2(0) & "' AND Rank<=10 AND Rank>0" )

		bGold = false
		If Not schoolSet.eof Then
			Do While Not schoolSet.eof
				If schoolSet(0) < 3 Then
					bGold = true
					Exit Do
				End If

				If ( 0 + Right( schoolSet(1), 2 ) ) < 6 Then
					bGold = true
					Exit Do
				End If

				schoolSet.MoveNext
			Loop
		End If

		If Not bGold Then
			' Okay, no gold prizes.  Check the number of individual entries > 10.
			Dim iEntries

			iEntries = 0
			Set schoolSet = oConn.Execute( "SELECT * FROM Students WHERE School='" & recordSet2(0) & "' AND Rank>=0 ORDER BY Rank" )
			Do While iEntries < 10 And Not schoolSet.eof
				If ( 0 + Right( schoolSet(2), 2 ) ) < 6 Then
					If iEntries = 0 Then
						strSchoolPrizeRef = schoolSet(2)
					End If
					iEntries = iEntries + 1
				End If
				schoolSet.MoveNext
			Loop

			If iEntries < 10 Then
				' We don't have a winner
				strSchoolPrizeRef = ""
			End If
		End If


		' Set up the heading for the new page
		strHTML = strHTML & strHeadingStart & recordSet2(0) & strHeadingEnd

		strHTML = strHTML & "<table width=100% style=""font-family: verdana; font-size: 7pt"">"
		strHTML = strHTML & strLabels
		strHTML = strHTML & showSchool( recordSet2(0), strSchoolPrizeRef )
		strHTML = strHTML & "<tr><td height=0><BR></td></tr></table>"

		recordSet2.MoveNext
	Loop

	strHTML = strHTML & "</table>"

	document.all.item( "showTable" ).style.display = "none"
	document.all.item( "showData" ).style.display  = ""
	document.all.item( "showData" ).innerHTML = strHTML
End Sub
</SCRIPT>
		</td>
	</tr>
	<tr>
		<td align=left>
			<HR size=1 width=80%>
		</td>
	</tr>
	<tr>
		<FORM name=showCertCountForm>
		<td>
			<b>Certificate Count Report</b>
			<small> - The number of certificates to be sent to each school.</small>
			<INPUT type=button name=showCertificateCount value="Show Report">
<SCRIPT type="text/VBScript">
Sub showCertificateCount_OnClick
	Dim strHTML
	Dim recordSet2
	Dim iPart
	Dim iGold
	Dim iMerit

	Dim iTotalPart
	Dim iTotalGold
	Dim iTotalMerit

	iTotalPart  = 0
	iTotalGold  = 0
	iTotalMerit = 0

	strHTML = "<table style=""font-family: verdana; font-size: 10pt""><tr><td colspan=4><b><big>Certificate Count</b></big></td></tr>"
	strHTML = strHTML & "<tr><td><i>School</i></td><td align=center><i>Gold</i></td><td align=center><i>Merit</i></td><td align=center><i>Participated</i></td><td align=center><i>Total</i></td></tr>"

	Set recordSet = oConn.Execute( "SELECT Name FROM Schools WHERE Entered<>0 ORDER BY Name" )
	Do While Not recordSet.eof
		iPart  = 0
		iGold  = 0
		iMerit = 0

		Set recordSet2 = oConn.Execute( "SELECT DISTINCT Reference, Rank FROM Students WHERE School='" & recordSet(0) & "' AND Rank>=0" )
		Do While Not recordSet2.eof

			If 0 + Right( recordSet2(0), 2 ) < 6 Then
				iPart = iPart + 1
				If recordSet2(1) > 0 And recordSet2(1) <= 10 Then
					iGold = iGold + 1
				Else
					If recordSet2(1) > 3 And recordSet2(1) <= 200 Then
						iMerit = iMerit + 1
					End If
				End If
			Else
				iPart = iPart + 2
				If recordSet2(1) > 0 And recordSet2(1) <= 3 Then
					iGold = iGold + 2
				Else
					If recordSet2(1) > 3 And recordSet2(1) <= 100 Then
						iMerit = iMerit + 2
					End If
				End If
			End If

			recordSet2.MoveNext			
		Loop

		strHTML = strHTML & "<tr><td>" & recordSet(0) & "</td><td align=center>" & iGold & "</td><td align=center>" & iMerit & "</td><td align=center>" & iPart - iMerit - iGold & "</td><td align=center>" & iPart & "</td></tr>"

		recordSet.MoveNext

		iTotalPart  = iTotalPart  + iPart
		iTotalGold  = iTotalGold  + iGold
		iTotalMerit = iTotalMerit + iMerit
	Loop

	strHTML = strHTML & "<tr><td colspan=5><HR width=100%></td><tr>"	
	strHTML = strHTML & "<tr><td><b>Totals:</b></td><td align=center>" & iTotalGold & "</td><td align=center>" & iTotalMerit & "</td><td align=center>" & iTotalPart - iTotalGold - iTotalMerit & "</td><td align=center>" & iTotalPart & "</td></tr>"

	strHTML = strHTML & "</table>"

	document.all.item( "showTable" ).style.display = "none"
	document.all.item( "showData" ).style.display  = ""
	document.all.item( "showData" ).innerHTML = strHTML
End Sub
</SCRIPT>
		</td>
		</FORM>
	</tr>
	<tr>
		<td align=left>
			<HR size=1 width=80%>
		</td>
	</tr>
	<tr>
		<FORM name=showVenuesForm>
		<td>
			<b>Venues Report</b>
			<small> - List of the venues.</small>
			<INPUT type=button name=showVenues value="Show Venues">
<SCRIPT type="text/VBScript">
Sub showVenues_OnClick
	Dim strHTML
	Dim recordSet2
	Dim strType

	strHTML = "<table width=80% style=""font-family: verdana; font-size: 10pt""><tr><td colspan=4><b><big>Venues</b></big></td></tr>"
	strHTML = strHTML & "<tr><td><i>Code</i></td><td><i>Building</i></td><td align=center><i>Seats</i></td><td align=center>Bums</td><td align=center>Grade</td><td>Type</td></tr>"
	strHTML = strHTML & "<tr><td><BR></td></tr>"

	Set recordSet = oConn.Execute( "SELECT * FROM Venues ORDER BY Building, Code" )

	Do While Not recordSet.eof
		If recordSet( 5 ) = -1 Then
			strType = "Pairs"
		Else
			strType = "Individuals"
		End If

		strHTML = strHTML & "<tr><td>" & recordSet(0) & "</td><td>" & recordSet(1) & "</td><td align=center>" & recordSet( 2 ) & "</td><td align=center>" & recordSet( 3 ) & "</td><td align=center>" & recordSet( 4 ) & "</td><td>" & strType & "</td></tr>"

		recordSet.MoveNext
	Loop
	
	strHTML = strHTML & "</table>"

	document.all.item( "showTable" ).style.display = "none"
	document.all.item( "showData" ).style.display  = ""
	document.all.item( "showData" ).innerHTML = strHTML
End Sub
</SCRIPT>
		</td>
		</FORM>
	</tr>
	<tr>
		<td align=left>
			<HR size=1 width=80%>
		</td>
	</tr>
	<tr>
		<FORM name=showAssignedVenuesForm>
		<td>
			<b>Assigned Venues Report</b>
			<small> - List of the venues assigned.</small><BR>
			&nbsp;&nbsp;
			<SELECT name=assignedGrade>
				<OPTION>All</OPTION>
				<OPTION>8</OPTION>
				<OPTION>9</OPTION>
				<OPTION>10</OPTION>
				<OPTION>11</OPTION>
				<OPTION>12</OPTION>
			</SELECT>
			<SELECT name=assignedType>
				<OPTION>All</OPTION>
				<OPTION>Individuals</OPTION>
				<OPTION>Pairs</OPTION>
			</SELECT>
			<INPUT type=button name=showAssignedVenues value="Show Assigned Venues">
<SCRIPT type="text/VBScript">
Sub showAssignedVenues_OnClick
	Dim strHTML
	Dim recordSet2
	Dim strType
	Dim iGrade
	Dim iStart
	Dim iEnd
	Dim strVenue
	Dim iPupils

	strHTML = "<table width=60% style=""font-family: verdana; font-size: 10pt""><tr><td colspan=4><b><big>Assigned Venues</b></big></td></tr>"
	strHTML = strHTML & "<tr><td><i>Code</i></td><td><i>Building</i></td><td align=center><i>Seats</i></td><td align=center><i>Pupils</i></td>"
	strHTML = strHTML & "<tr><td><BR></td></tr>"

	iStart = 8
	iEnd   = 12

	If document.showAssignedVenuesForm.assignedGrade.selectedIndex <> 0 Then
		iStart = document.showAssignedVenuesForm.assignedGrade.selectedIndex + 7
		iEnd   = iStart
	End If

	For iGrade = iStart to iEnd
		If document.showAssignedVenuesForm.assignedType.selectedIndex <> 2 Then
			strHTML = strHTML & "<tr><td colspan=4><b><big>Grade " & iGrade & " Individuals</td></tr>"

			Set recordSet = oConn.Execute( "SELECT * FROM Venues WHERE Grade=" & iGrade & " AND Pairs=0 ORDER BY Building, Code" )

			Do While Not recordSet.eof
				strVenue = recordSet( 1 ) & " " & recordSet( 0 )

				Set recordSet2 = oConn.Execute( "SELECT * FROM Students WHERE Venue='" & strVenue & "'" )
				iPupils = 0

				Do While Not recordSet2.eof
					iPupils = iPupils + 1
					recordSet2.moveNext
				Loop

				strHTML = strHTML & "<tr><td>" & recordSet( 0 ) & "</td><td>" & recordSet( 1 ) & "</td><td align=center>" & recordSet( 2 ) & "</td><td align=center>" & iPupils & "</td></tr>"

				recordSet.moveNext
			Loop
		End If

		If document.showAssignedVenuesForm.assignedType.selectedIndex <> 1 Then
			strHTML = strHTML & "<tr><td colspan=4><b><big>Grade " & iGrade & " Pairs</td></tr>"

			Set recordSet = oConn.Execute( "SELECT * FROM Venues WHERE Grade=" & iGrade & " AND Pairs=-1 ORDER BY Building, Code" )

			Do While Not recordSet.eof
				strVenue = recordSet( 1 ) & " " & recordSet( 0 )

				Set recordSet2 = oConn.Execute( "SELECT * FROM Students WHERE Venue='" & strVenue & "'" )
				iPupils = 0

				Do While Not recordSet2.eof
					iPupils = iPupils + 1
					recordSet2.moveNext
				Loop

				strHTML = strHTML & "<tr><td>" & recordSet( 0 ) & "</td><td>" & recordSet( 1 ) & "</td><td align=center>" & recordSet( 2 ) & "</td><td align=center>" & iPupils & "</td></tr>"

				recordSet.moveNext
			Loop
		End If
	Next

	strHTML = strHTML & "</table>"

	document.all.item( "showTable" ).style.display = "none"
	document.all.item( "showData" ).style.display  = ""
	document.all.item( "showData" ).innerHTML = strHTML
End Sub
</SCRIPT>
		</td>
		</FORM>
	</tr>
	<tr>
		<td align=left>
			<HR size=1 width=80%>
		</td>
	</tr>
</table>

</td></tr>
</table>
<!-- Closing showTable table... -->
